# Лабораторная работа №2. Мини-оболочка с файловыми командами

Попков Максим Александрович

Группа: М8О-105БВ-25

## Цель и результаты
- Освоить работу с файловой системой Python. 
- Реализовать основные команды управления файлами и каталогами. 
- Научиться вести журнал действий пользователя в storage/shell.log.
- (Medium) Добавить плагины для архивов (zip, tar).


## Структура проекта

 <pre> . 
├── lab2 
│ ├── src/ # Исходный код 
│ │ ├── fs.py # Реализация команд ls, cd, cat, cp, mv, rm 
│ │ ├── plugins.py # Реализация плагинов: history, undo, zip, unzip, tar, untar 
│ │ ├── store.py # Хранилище и журнал: log, history, undo (.json) 
│ │ ├── state.py # Класс состояния оболочки 
│ │ ├── errors.py # Классы пользовательских ошибок 
│ │ ├── utils.py # Вспомогательные функции (уникальные имена и т.д.) 
│ │ ├── constants.py # Пути и форматирование логов 
│ │ └── main.py # Точка входа (интерактивная оболочка) 
│ ├── storage/ # Рабочее хранилище программы 
│ │ ├── .trash/ # Корзина (удалённые файлы) 
│ │ ├── .history # История команд 
│ │ ├── .undo.json # Последние операции для undo 
│ │ └── shell.log # Журнал действий 
│ ├── test/ # Тесты PyTest 
│ │ ├── test_dir/ # Песочница для файловых тестов 
│ │ ├── test_fs.py # Тесты команд ls, cd, cat, cp, mv, rm 
│ │ └── test_plugins.py # Тесты history, undo, zip, tar 
│ ├── requirements.txt # Зависимости проекта 
│ ├── report.pdf # Отчёт по лабораторной работе 
│ ├── .pre-commit-config.yaml # Настройки линтера и автопроверок 
│ └── README.md # Описание проекта </pre>

## Установка и запуск
<pre>
git clone https://github.com/Maximoff35/Popkov-python-labs-mai-1sem
cd <папка_проекта>/lab2
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
</pre>

### Запуск программы
<pre>
python -m src.main
</pre>

После запуска откроется мини-терминал:
<pre>
Мини-оболочка: введите "exit", чтобы выйти.
</pre>

### Команды

| Команда                           | Назначение                     | Опции / особенности                           |
|-----------------------------------| ------------------------------ | --------------------------------------------- |
| **ls [path] [-l]**                | Список файлов и папок          | `-l` — подробный вывод (размер, дата, права)  |
| **cd [path]**                     | Переход в каталог              | Поддержка `..`, `~`, абсолютных путей         |
| **cat [file]**                    | Вывод содержимого файла        | Ошибка при передаче каталога                  |
| **cp <откуда> <куда>**            | Копирование файла/каталога     | `-r` — рекурсивное копирование                |
| **mv <откуда> <куда>**            | Перемещение или переименование | Проверка на существование назначения          |
| **rm <что>**                      | Удаление файла/каталога        | `-r` — рекурсивно, с подтверждением `y/n`     |
| **history [N]**                   | Показ N последних команд       | История хранится в `.history`                 |
| **undo**                          | Отмена последней `cp/mv/rm`    | Восстановление из `.trash` или удаление копии |
| **zip <folder> <archive.zip>**    | Архивация каталога             | Создание `.zip` архива                        |
| **unzip <archive.zip>**           | Распаковка архива              | В текущий каталог                             |
| **tar <folder> <archive.tar.gz>** | Архивация каталога             | Формат TAR.GZ                                 |
| **untar <archive.tar.gz>**        | Распаковка архива              | В текущий каталог                             |


## Логирование

Все команды и ошибки автоматически пишутся в файл `storage/shell.log` в виде:
<pre>
[2025-11-06 13:45:22] ls -l /home/user
[2025-11-06 13:45:23] ERROR: No such file or directory
</pre>

## Тестирование

Для запуска тестов:

<pre>
pytest -v
</pre>

Тесты включают:

- работу всех файловых команд (ls, cd, cat, cp, mv, rm);
- корректность журналирования и undo; 
- работу плагинов (zip, unzip, tar, untar, history); 
- обработку ошибок и исключений.