# Лабораторная работа №4. Библиотека с пользовательскими коллекциями

Попков Максим Александрович  
Группа: М8О-105БВ-25

## Цель и результаты

- Реализовать модель библиотеки с книгами, пользовательскими коллекциями и индексами.  
- Освоить работу с классами, наследованием и проверкой входных данных.  
- Научиться строить удобный интерфейс для поиска и удаления объектов.  
- Реализовать имитацию работы библиотеки с использованием модуля `random` и логированием в файл `shell.log`.

## Структура проекта

```text
.
├── lab4
│   ├── src/
│   │   ├── __init__.py
│   │   ├── collections.py      # Пользовательские коллекции книг (список и словарь-индекс)
│   │   ├── constants.py        # Наборы констант для генерации книг и настройки логгера
│   │   ├── library.py          # Класс Library, объединяющий коллекцию и индексы
│   │   ├── log.py              # Инициализация логгера и функции log_ok / log_error
│   │   ├── main.py             # Точка входа, запуск симуляции по введённому числу шагов
│   │   ├── models.py           # Классы Book, FictionBook, ScienceBook
│   │   └── simulation.py       # Генерация случайных книг и функция run_simulation
│   ├── .gitignore              # Игнорируемые файлы для git
│   ├── .pre-commit-config.yaml # Настройки линтеров и автоформатирования
│   ├── requirements.txt        # Зависимости проекта (стандартная библиотека Python)
│   ├── report.pdf              # Отчёт по лабораторной работе
│   └── README.md               # Описание проекта
```

## Описание реализованных модулей

### `models.py`
- `Book` — базовая модель книги (название, автор, год, жанр, ISBN) с проверкой входных данных.  
- `FictionBook` — художественная книга с дополнительным полем возрастного ограничения.  
- `ScienceBook` — научная книга с полем области науки.  
Классы переопределяют `__repr__`, чтобы в логах отображались понятные строки.

### `collections.py`
- `BookCollection` — списковая коллекция книг: поддерживает добавление, удаление по ISBN, проверку наличия, индексацию, срезы и итерацию.  
- `IndexDict` — словарная коллекция индексов по `isbn`, `author` и `year`, обеспечивающая быстрый поиск и согласованное удаление из всех индексов.

### `library.py`
Класс `Library` хранит `BookCollection` и `IndexDict` и предоставляет высокоуровневые методы:
- добавление и удаление книг (по объекту и по ISBN);
- поиск по ISBN, автору, году и жанру;
- итерацию по всем книгам и получение размера библиотеки.

### `simulation.py`
Содержит:
- функцию `generate_random_book()`, которая создаёт случайный объект `Book`, `FictionBook` или `ScienceBook`;  
- функцию `run_simulation(steps: int = 50, seed: int | None = None)`, которая:
  - выполняет заданное число шагов;
  - случайным образом выбирает операции (ADD, REMOVE, FIND_*);
  - генерирует как корректные, так и заведомо неверные запросы (невалидные ISBN/год);
  - записывает все действия и ошибки в лог.

### `log.py` и `constants.py`
- `log.py` настраивает логирование в файл `shell.log` и в консоль и предоставляет функции `log_ok` и `log_error`.  
- `constants.py` содержит списки названий книг, авторов, жанров, областей науки, алфавит для ISBN, а также настройки формата логов.

### `main.py`
Точка входа: запрашивает у пользователя количество шагов симуляции (целое число ≥ 10) и запускает `run_simulation`. При некорректном вводе выводит сообщение об ошибке и завершает программу.

## Установка и запуск

```bash
git clone https://github.com/Maximoff35/Popkov-python-labs-mai-1sem
cd <папка_проекта>/lab4
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt
```

### Запуск программы

```bash
python -m src.main
```

В процессе работы в корне лабораторной создаётся файл `shell.log` с подробным журналом действий симуляции.

## Тестирование

Отдельные автотесты для данной лабораторной не предусмотрены, основные проверки проводятся через запуск симуляции с разными параметрами `steps` и `seed`.
